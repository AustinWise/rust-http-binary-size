# How much binary size does different Rust HTTP clients require

While working on an installer for [Smeagol](https://github.com/AustinWise/smeagol),
I wondered how I could minimize the binary size impact of a HTTP client. The
short answers is [cURL](https://crates.io/crates/curl) is probably the best
balance of ease-of-use and binary size.

## Experiment environment

I used:

* x86_64
* Rust 1.58.1.
* Ubuntu 20.04
* Windows 11 (10.0.22000.434)

## Linux Notes

I did not do a lot of work on Linux. A striped binary that downloads some text
using `cURL-rust` was 719K.

I could reduce this to 339K by using the system
`libcurl` library. I need to install `libcurl4-openssl-dev` for this to work.
Using `ldd` on the resulting binary shows a ton more libraries than embedding a
copy of cURL in the binary. So I assume that by linking against the system cURL
library you run a greater risk of the binary not running on some systems.
Therefore I would stick to the embedded current method unless you are packaging
your binary for release on a specific. For example, if you were making a `.deb`
file for release through a PPA for Ubuntu, you could easily include the
dependency on any relevant debian packages.

## Windows Notes

I used the MSVC target (`x86_64-pc-windows-msvc`) on Windows. I *did not* set
[`crt-static`](https://rust-lang.github.io/rfcs/1721-crt-static.html) property,
so these binary sizes are a bit smaller than what a truly statically-linked
binary would be. But I'm fairly confident that the relative numbers are still
useful.

These sizes were generated by running the following on the different branches:

```
cargo build --release
dir target\release\httptest.exe
```

For smallest to biggest

|branch and crate name|size|
|--|--|
|master (baseline, just a hello-world)|148,480|
|[winhttp](https://github.com/AustinWise/rust-http-binary-size/commit/dbc034d9ace89dae2223eb206fbdddb04ae14cd2)|164,352|
|[curl](https://github.com/AustinWise/rust-http-binary-size/commit/0d22aa271c4f2f2668ca68eb407da26bfb331a08)|564,224|
|[hyper (HTTP 1.1 only)](https://github.com/AustinWise/rust-http-binary-size/commit/c5b66a768546711952d66f53285e730cab6cac60)|1,415,680|
|[ureq](https://github.com/AustinWise/rust-http-binary-size/commit/234d599091c017a61a0252eeb35212f45cbc4473)|2,129,920|
|[hyper (Full features)](https://github.com/AustinWise/rust-http-binary-size/commit/e13f68276deb6dc02147c67a56a5e247a35242b1)|2,390,016|
|[reqwest](https://github.com/AustinWise/rust-http-binary-size/commit/15b8ded17c0d42446624e5af0131e16de46ea863)|3,159,552|

Note that the `winhttp` branch is just me directly calling the built-in HTTP
client in the Windows Operating System. Actually deploying it would require a
lot of work to flesh out the client. In particular, care would need to be taken
to ensure new TLS protocols are supported. On older operating system TLS v1.2 is
not supported by default, while many online services require it. So it might be
a lot more work to keep the long tail working on WinHTTP.
